!function(a){a.sheeper=a.inputSheeper=function(b,c){var d,e=this,f={selector:".sheep",placeholder:/(__|\{\{\s?)NAME(__|\}\}\s?)/gi,addSelector:".sheep-link",removeSelector:".unsheep-link",moveUpSelector:".sheepup-link",moveDownSelector:".sheepdown-link",min:1,max:100,prepend:!1,afterInit:function(a){return!0},afterSheep:function(a){return!0},beforeUnsheep:function(a){return!0},afterUnsheep:function(a){return!0},beforeMove:function(a){return!0},afterMove:function(a){return!0},beforeMoveUp:function(a){return!0},afterMoveUp:function(a){return!0},beforeMoveDown:function(a){return!0},afterMoveDown:function(a){return!0}},g=a(b),h=[];e.settings={},e.init=function(){if(e.settings=a.extend({},f,g.data(),c),d=e.settings.container?g.find(e.settings.container):g,!e.settings.prototype)return void console.error("No template found. Please provide a template using the 'prototype' javascript option or data-prototype HTML attribute.");if(e.settings.prototype.match(/^(#|\\.)[a-zA-Z].*/)){var b=a(e.settings.prototype);if(0===b.length)return void console.error("No template found. Prototype '"+e.settings.prototype+"' does not exists.");b.hide(),e.settings.prototype=b.html()}e.execute(),e.settings.afterInit(g)},e.execute=function(){e.numberOfSheeps()>0&&d.children().each(function(){i(this)});var b=e.numberOfSheeps();if(b<e.settings.min)for(var c=0;c<e.settings.min-b;c++)i();g.find(e.settings.addSelector).on("click",function(b){b.preventDefault(),a(this).is(".disabled,:disabled")||i()}),d.on("click",e.settings.removeSelector,function(b){b.preventDefault(),a(this).is(".disabled,:disabled")||j(this)}),d.on("click",e.settings.moveUpSelector,function(b){b.preventDefault(),a(this).is(".disabled,:disabled")||k(this)}),d.on("click",e.settings.moveDownSelector,function(b){b.preventDefault(),a(this).is(".disabled,:disabled")||l(this)}),g.on("moved.jq.sheeper",function(a){t()})};var i=function(b){if(!(e.numberOfSheeps()>=e.settings.max)){var c=null;if(b)c=a(b),f=a(b).data("sheep-id"),void 0===f&&(f=u(),c.data("sheep-id",f)),h.push(f);else{var f=u();c=a(e.settings.prototype.replace(e.settings.placeholder,f)),c.data("sheep-id",f),h.push(f),e.settings.prepend?d.prepend(c):d.append(c)}e.settings.afterSheep(c),c.trigger(a.Event("sheeped.jq.sheeper",{})),m()}},j=function(b){if(e.numberOfSheeps()>e.settings.min){var c=a(b).closest(e.settings.selector);e.settings.beforeUnsheep(c),c.trigger(a.Event("unsheep.jq.sheeper",{})),c.remove(),e.settings.afterUnsheep(c),d.trigger(a.Event("unsheeped.jq.sheeper",{relatedTarget:c[0]}))}m()},k=function(b){var c=a(b).parents(e.settings.selector),d=c.prev(e.settings.selector);d.length&&(e.settings.beforeMove(c),c.trigger(a.Event("moving.jq.sheeper",{relatedTarget:d[0]})),e.settings.beforeMoveUp(c),c.trigger(a.Event("moving-up.jq.sheeper",{relatedTarget:d[0]})),c.detach().insertBefore(d),c.trigger(a.Event("moved-up.jq.sheeper",{relatedTarget:d[0]})),e.settings.afterMoveUp(c),c.trigger(a.Event("moved.jq.sheeper",{relatedTarget:d[0]})),e.settings.afterMove(c)),m()},l=function(b){var c=a(b).parents(e.settings.selector),d=c.next(e.settings.selector);d.length&&(e.settings.beforeMove(c),c.trigger(a.Event("moving.jq.sheeper",{relatedTarget:d[0]})),e.settings.beforeMoveDown(c),c.trigger(a.Event("moving-down.jq.sheeper",{relatedTarget:d[0]})),c.detach().insertAfter(d),c.trigger(a.Event("moved-down.jq.sheeper",{relatedTarget:d[0]})),e.settings.afterMoveDown(c),c.trigger(a.Event("moved.jq.sheeper",{relatedTarget:d[0]})),e.settings.afterMove(c)),m()};e.getSheeps=function(){return d.children(e.settings.selector)},e.numberOfSheeps=function(){return e.getSheeps().length};var m=function(){var b=e.getSheeps();e.numberOfSheeps()>e.settings.min?p():q(),e.numberOfSheeps()<e.settings.max?n():o(),b.each(function(b,c){var d=a(c);d.find(e.settings.moveUpSelector).each(function(b,c){a(c).removeClass("disabled")}),d.find(e.settings.moveDownSelector).each(function(b,c){a(c).removeClass("disabled")})}),b.first().find(e.settings.moveUpSelector).addClass("disabled"),b.last().find(e.settings.moveDownSelector).addClass("disabled")},n=function(){d.find(e.settings.addSelector).removeClass("disabled")},o=function(){d.find(e.settings.addSelector).addClass("disabled")},p=function(){d.find(e.settings.removeSelector).removeClass("disabled")},q=function(){d.find(e.settings.removeSelector).addClass("disabled")},r=function(a){for(var b=a.concat().sort(),c=b[0],d=b[b.length-1],e=c.length,f=0;e>f&&c.charAt(f)===d.charAt(f);)f++;return c.substring(0,f)},s=function(b){var c=a.map(b,function(b,c){return a(b).attr("name")});return r(c)},t=function(){for(var b=e.getSheeps(),c=0;c<b.length;c++){var d=a(b[c]).find("input, select, textarea");if(d=a.grep(d,function(a,b){return""!==a.name}),0===d.length)return;var f=s(d);if(f){var g=f.replace(/(.*)\d+(.*)$/,"$1"+c+"$2");a.each(d,function(b,c){a(c).attr("name",a(c).attr("name").replace(f,g))})}}},u=function(){for(var b=0;-1!==a.inArray(b,h);)b++;return b};e.init()},a.fn.sheeper=a.fn.inputSheeper=function(b){return this.each(function(){if(void 0==a(this).data("inputSheeper")){var c=new a.sheeper(this,b);a(this).data("inputSheeper",c)}})},a(document).ready(function(){a('[data-toggle="sheeper"]').sheeper({})})}(jQuery);